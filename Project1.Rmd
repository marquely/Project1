---
title: "Project1"
author: Lindsey Marquez
output: word_document
---

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = TRUE)

#change the input file to TCGA_breast_cancer_ERpositive_vs_ERnegative_PAM50.tsv

file <- "TCGA_breast_cancer_ERpositive_vs_ERnegative_PAM50.tsv"
first10 <- c('NAT1','BIRC5','BAG1','BCL2','BLVRA','CCNB1','CCNE1','CDC6','CDC20','CDH3')
```

## Assignment

Please paste the assignment here

## Reading data

Please add R code that reads data here - 
reading file: `r file`

```{r reading_data, echo=FALSE}
system.time({
# important -- this makes sure our runs are consistent and reproducible
set.seed(0)

header <- scan(file, nlines = 1, sep="\t", what = character())
data <- read.table(file, skip = 2, header = FALSE, sep = "\t", quote = "", check.names=FALSE)

header[1] <- "gene_id"
names(data) <- header

header2 <- scan(file, skip = 1, nlines = 1, sep="\t", what = character())
})
```

## Computation

Please add R code that computes the results

```{r computation, echo=FALSE}
Positive <- data[, header2 == "Positive", drop = FALSE]
Negative <- data[, header2 == "Negative", drop = FALSE]

cross_validation <- function(nfold = 5, alg = "centroid")
  { 
  # split each cancer type samples into nfold groups
  ERpositive_groups <- split( sample(colnames(Positive)), cut(seq_along(colnames(Positive)), nfold, labels = FALSE) )
  ERnegative_groups <- split( sample(colnames(Negative)), cut(seq_along(colnames(Negative)), nfold, labels = FALSE) )
  
  result <- numeric(nfold)
  # iterate from 1 to nfold groups -- to choose test group for (test_group in 1:nfold)
  
  for (test_group in 1:nfold) {
  # return all samples in the chosen test group 
  test_ER_pos <- Positive[, colnames(Positive) %in% unlist(ERpositive_groups[test_group]), drop = FALSE]
  test_ER_neg <- Negative[, colnames(Negative) %in% unlist(ERnegative_groups[test_group]), drop = FALSE]
  
  # return all samples *not* in the chosen test group 
  trainingERpos <- Positive[, !(colnames(Positive) %in% unlist(ERpositive_groups[test_group])), drop = FALSE]
  trainingERneg <- Negative[, !(colnames(Negative) %in% unlist(ERnegative_groups[test_group])), drop = FALSE] 
  
  
  if (alg == "centroid") { 
    centroidERpos <- rowMeans(trainingERpos) 
    centroidERneg <- rowMeans(trainingERneg) 
    test_ER_pos <- as.matrix(test_ER_pos) 
    test_ER_neg <- as.matrix(test_ER_neg) 
    misclassifiedERpos <- sum(apply(test_ER_pos, 2, function(x) sum(abs(x - centroidERpos)) > sum(abs(x - centroidERneg))))
    misclassifiedERneg <- sum(apply(test_ER_neg, 2, function(x) sum(abs(x - centroidERpos)) < sum(abs(x - centroidERneg)))) 
    }
  
  if (alg == "GLM") { 
    
    # Build training data frame 
    trainingER <- rbind( cbind(data.frame(t(trainingERpos)), cancer = 1), 
              cbind(data.frame(t(trainingERneg)), cancer = 0) )
  
  # Build test data set 
  test_ER <- rbind( data.frame(t(test_ER_pos)), data.frame(t(test_ER_neg)))
  
  # True labels 
  truth <- c(rep(1, ncol(test_ER_pos)), rep(0, ncol(test_ER_neg)))
  
  # Logistic regression
  model <- glm(cancer ~ ., data = trainingER, family = binomial)
  p <- predict(model, newdata = test_ER, type = "response")
  preds <- ifelse(p < 0.5, 0, 1)
  misclassifiedERpos <- sum(preds[truth == 1] == 0)
  misclassifiedERneg <- sum(preds[truth == 0] == 1) } 
  result[test_group] <- (misclassifiedERpos + misclassifiedERneg) / (ncol(test_ER_pos) + ncol(test_ER_neg))
  }
  return(list(mean = mean(result), sd = sd(result)))
}
system.time({
  
ER_Positive <- data[,header2=='Positive']
ER_Negative <- data[,header2=='Negative']

kNNC_5_all <- cross_validation(nfold=5)
GLM_5_all <- cross_validation(nfold=5, alg="GLM")

kNNC_10_all <- cross_validation(nfold=20)
GLM_10_all <- cross_validation(nfold=10, alg="GLM")

# FIXME: add code to compute 10 fold cross validation for GLM and kNNC

})

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code.

## Results

These are our results:

### 5-fold cross validation
```{r results5, echo=FALSE}
x<-data.frame("GLM"=c(GLM_5_all,GLM_10_all),"kNNC"=c(kNNC_5_all,kNNC_10_all))
rownames(x) <- c("5-fold","10-fold")
kable(x)
```


## Discussion

This is what I found out

# Part 2

Change eval=TRUE when ready to include Project1fs.R

```{r part2, eval = FALSE, code=readLines("Project1fs.R"), echo=FALSE}
```
